"use strict";function states(e,t){t.otherwise("find");var n="";e.state("find",{url:"/find",templateUrl:"/app/find/find.html"}).state("schedule",{url:n+"/schedule",templateUrl:"/app/schedule/schedule.html"}).state("schedule.campus",{url:n+"/:campus",templateUrl:"/app/schedule/schedule.html"}).state("schedule.class",{url:n+"/:cName",templateUrl:"/app/schedule/schedule.html"}).state("schedule.class.week",{url:n+"/:wn",templateUrl:"/app/schedule/schedule.html"})}function autoFill(e){function t(t,n,a){function s(){o=a.autoFillKeys.split(",")}function c(){function e(t,n){if(t instanceof Array)for(var a=0;a<t.length;a++)t[a]instanceof Object?e(t[a],n):t[a][n]&&r.push({name:t[a][n],"class":t[a]._id});else if(t instanceof Object)for(var s in t)s===n&&r.push({name:t[n],"class":t._id}),t[s]instanceof Array&&e(t[s],n)}if(o instanceof Array)for(var t=0;t<o.length;t++)e(l[a.autoFillVmSrc],o[t]);else e(l[a.autoFillVmSrc],o)}function u(){function e(){for(var e=0;e<r.length;e++)if(a(r[e])>-1&&t.outputs.push(r[e]),t.outputs.length>=10)return}function n(){r.sort(function(e,t){return a(e)-a(t)})}function a(e){return e.name.toLowerCase().indexOf(t.searchModel.toLowerCase())}return t.searchModel.length?(t.outputs=[],e(),void n()):void(t.outputsActive=!1)}var l=t[a.autoFillVm],o=void 0;s();var r=[];t.searchModel=[],r.length||c();(function(){var a="<div ng-click='searchThis()' class='search'><input class='data-search' type='text' ng-model='searchModel' ng-change='inputChanged()'><div class='search-output'><div class='item item-label search-output-single' ng-repeat='searchOutput in outputs track by $index' ><span ng-click='activateSeachOutput(searchOutput)' class=''>{{searchOutput.name}}</span></div></div></div>";n.append(e(a)(t))})();t.inputChanged=function(){r.length||c(),u(),l.seachModel=t.seachModel},t.activateSeachOutput=function(e){t.seachModel=e,l.seachModel=e,n.find("input")[0].value=e.name,t.outputs=[]}}return{scope:"=",link:t,template:"",restrict:"E"}}function dataFact(e,t,n){function a(e,t,a,s){l[e]?a(c[t]):n(function(){l[e]?a(c[t]):s("API unavailable at this time, so sorry")},5e3)}function s(e,t){console.log(e);for(var n=0;n<c.campuses.length;n++)c.campuses[n]._id===e[0].campus&&(c.campuses[n][t]=e)}var c={};c.campuses=[],c.weeks=[];var u=new Date,l={campuses:!1,classes:!1,weeks:!1};return c.init=function(){console.log("Data factory initialized, getting data"),e.get("/campus").then(function(e){c.campuses=e.data,l.campuses=!0,c.initClasses()})["catch"](function(e){console.warn("err@datafact campus",e)})},c.initClasses=function(){function t(n){e.get("/campus/"+encodeURI(c.campuses[n].name)+"/classes").then(function(e){s(e.data,"classes"),n<c.campuses.length-1?t(n+=1):(console.log("classes done"),l.classes=!0,c.initWeeks())})}t(0)},c.initWeeks=function(){function t(n){e.get("/campus/"+encodeURI(c.campuses[n].name)+"/weeks").then(function(e){c.weeks.push(e.data),n<c.campuses.length-1?t(n+=1):(l.weeks=!0,console.log("weeks done"))})}t(0)},c.getWeekData=function(e){for(var t=new Date(u).getWeek(),n=0;n<c.weeks.length;n++)for(var a=0;a<c.weeks[n].length;a++)if(c.weeks[n][a]["class"]===e["class"]&&c.weeks[n][a].weekNumber===t)return c.weeks[n][a].name=e.name,console.log(c.weeks[n]),c.weeks[n][a]},c.getCampus=function(){return t(function(e,t){a("campuses","campuses",e,t)})},c.getCampusData=function(){return t(function(e,t){a("classes","campuses",e,t)})},c.getCampusWeeks=function(){return t(function(e,t){a("weeks","weeks",e,t)})},c.getSchedule=function(e){return t(function(t,a){function s(){e.classId||u(),console.log(e),t(o())}function u(){for(var t=0;t<c.campuses.length;t++)for(var n=0;n<c.campuses[t].classes.length;n++)if(c.campuses[t].classes[n].name===e.name)return void(e.classId=c.campuses[t].classes[n]._id)}function o(){for(var t=0;t<c.weeks.length;t++)for(var n=0;n<c.weeks[t].length;n++)if(c.weeks[t][n]["class"]===e.classId)return c.weeks[t][n].name=e.name,c.weeks[t][n]}l.weeks?s():n(function(){l.weeks?s():a("API unavailable at this time, so sorry")},5e3)})},c.init(),c}function findCtrl(e,t,n){var a=this;!function(){e.getCampusData().then(function(e){a.campuses=e})["catch"](function(e){console.error(e)})}(),a.findSchedule=function(){console.log(a.seachModel);var s=e.getWeekData(a.seachModel);console.log(s),t.setSchedule(s),n.go("schedule.class.week",{cName:encodeURI(s.name),wn:encodeURI(s.weekNumber)})}}function httpFact(e){var t={},n="/api";return t.get=function(t){return e.get(n+t)},t}function scheduleCtrl(e){function t(e){for(var t=0;t<e.length;t++)for(var n=0;n<e[t].slots.length;n++);return e}var n=this;e.getSchedule().then(function(e){e.schedule=t(e.schedule),n.scheduleItem=e,console.log(n.scheduleItem)})}function scheduleFact(e,t,n){function a(){u.weekNumber=e.wn,u.name=e.cName,u.weekNumber===c.weekNumber&&u.name===c.name&&(l=!0)}var s={},c={weekNumber:null,name:null},u={},l=void 0;return s.setSchedule=function(e){c=e},s.getSchedule=function(){return n(function(e,n){a(),l?e(c):t.getSchedule(u).then(function(t){s.setSchedule(t),e(c)})["catch"](function(t){e(t)})})},s}var APPNAME="lukkari";angular.module(APPNAME,["ui.router","ngMaterial"]),Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this-e)/864e5+e.getDay()+1)/7)},angular.module(APPNAME).config(states,"states"),states.$inject=["$stateProvider","$urlRouterProvider"],angular.module(APPNAME).directive("autoFill",autoFill),autoFill.$inject=["$compile"],angular.module(APPNAME).factory("dataFact",dataFact),angular.module(APPNAME).controller("findCtrl",findCtrl),angular.module(APPNAME).factory("httpFact",httpFact),httpFact.$inject=["$http"],angular.module(APPNAME).controller("scheduleCtrl",scheduleCtrl),scheduleCtrl.$inject=["scheduleFact"],angular.module(APPNAME).factory("scheduleFact",scheduleFact);