"use strict";function states(e,t){t.otherwise("find");var s="";e.state("find",{url:"/find",templateUrl:"/app/find/find.html"}).state("schedule",{url:s+"/schedule",templateUrl:"/app/schedule/schedule.html"}).state("schedule.campus",{url:s+"/:campus",templateUrl:"/app/schedule/schedule.html"}).state("schedule.class",{url:s+"/:cName",templateUrl:"/app/schedule/schedule.html"}).state("schedule.class.week",{url:s+"/:wn",templateUrl:"/app/schedule/schedule.html"}).state("schedule.campus.class",{url:s+"/:cName",templateUrl:"/app/schedule/schedule.html"}).state("schedule.campus.class.week",{url:s+"/:wn",templateUrl:"/app/schedule/schedule.html"})}function autoFill(e){function t(t,s,a){function n(){o=a.autoFillKeys.split(",")}function c(){function e(t,s){if(t instanceof Array)for(var a=0;a<t.length;a++)t[a]instanceof Object?e(t[a],s):t[a][s]&&i.push({name:t[a][s],"class":t[a]._id});else if(t instanceof Object)for(var n in t)n===s&&i.push({name:t[s],"class":t._id}),t[n]instanceof Array&&e(t[n],s)}if(o instanceof Array)for(var t=0;t<o.length;t++)e(l[a.autoFillVmSrc],o[t]);else e(l[a.autoFillVmSrc],o)}function u(){function e(){for(var e=0;e<i.length;e++)if(a(i[e])>-1&&t.outputs.push(i[e]),t.outputs.length>=10)return}function s(){i.sort(function(e,t){return a(e)-a(t)})}function a(e){return e.name.toLowerCase().indexOf(t.searchModel.toLowerCase())}return t.searchModel.length?(t.outputs=[],e(),void s()):void(t.outputsActive=!1)}var l=t[a.autoFillVm],o=void 0;n();var i=[];t.searchModel=[],i.length||c();(function(){var a="<div ng-click='searchThis()' class='search'><input class='data-search' type='text' ng-model='searchModel' ng-change='inputChanged()'><div class='search-output'><div class='item item-label search-output-single' ng-repeat='searchOutput in outputs track by $index' ><span ng-click='activateSeachOutput(searchOutput)' class=''>{{searchOutput.name}}</span></div></div></div>";s.append(e(a)(t))})();t.inputChanged=function(){i.length||c(),u(),l.seachModel=t.seachModel},t.activateSeachOutput=function(e){t.seachModel=e,l.seachModel=e,s.find("input")[0].value=e.name,t.outputs=[]}}return{scope:"=",link:t,template:"",restrict:"E"}}function dataFact(e,t,s){function a(e){function t(){for(var t=0;t<u.campuses.length;t++)for(var s=0;s<u.campuses[t].classes.length;s++)if(u.campuses[t].classes[s].name===e["class"])return void(e.classId=u.campuses[t].classes[s]._id)}t(),console.log(e);for(var s=0;s<u.weeks.length;s++)for(var a=0;a<u.weeks[s].length;a++)if(u.weeks[s][a]["class"]===e.classId)return u.weeks[s][a].name=e.name,u.weeks[s][a]}function n(e,t,a,n){o[e]?a(u[t]):!function(){var c=function l(c){s(function(){o[e]?a(u[t]):10>c?l(++c):n("API unavailable at this time, so sorry")},500)};c(0)}()}function c(e,t){for(var s=0;s<u.campuses.length;s++)u.campuses[s]._id===e[0].campus&&(u.campuses[s][t]=e)}var u={};u.init,u.campuses=[],u.weeks=[];var l=new Date,o={campuses:!1,classes:!1,weeks:!1};return u.init=function(){u.init=!0,console.log("Data factory initialized, getting data"),e.get("/campus").then(function(e){u.campuses=e.data,o.campuses=!0,u.initClasses()})["catch"](function(e){console.warn("err@datafact campus",e)})},u.initClasses=function(){function t(s){e.get("/campus/"+encodeURI(u.campuses[s].name)+"/classes").then(function(e){c(e.data,"classes"),s<u.campuses.length-1?t(s+=1):(console.log("classes done"),o.classes=!0,u.initWeeks())})}t(0)},u.initWeeks=function(){function t(s){e.get("/campus/"+encodeURI(u.campuses[s].name)+"/weeks").then(function(e){u.weeks.push(e.data),s<u.campuses.length-1?t(s+=1):(o.weeks=!0,console.log("weeks done"))})}t(0)},u.getWeekData=function(e){for(var s=t.defer(),a=new Date(l).getWeek(),n=void 0,c=0;c<u.weeks.length;c++)for(var o=0;o<u.weeks[c].length;o++)if(u.weeks[c][o]["class"]===e["class"]&&u.weeks[c][o].weekNumber===a){u.weeks[c][o].name=e.name,n=u.weeks[c][o];break}return n?u.campuses.forEach(function(e,t,a){u.campuses[t].classes.forEach(function(e,a,c){u.campuses[t].classes[a]._id===n["class"]&&(n.campus=u.campuses[t].name,s.resolve(n))})}):s.reject("No schedule found"),s.promise},u.getCampus=function(){return t(function(e,t){n("campuses","campuses",e,t)})},u.getCampusData=function(){return t(function(e,t){n("classes","campuses",e,t)})},u.getCampusWeeks=function(){return t(function(e,t){n("weeks","weeks",e,t)})},u.getSchedule=function(e){return t(function(t,n){function c(){e.classId||l(),console.log(e),t(a())}function l(){for(var t=0;t<u.campuses.length;t++)for(var s=0;s<u.campuses[t].classes.length;s++)if(u.campuses[t].classes[s].name===e.name)return void(e.classId=u.campuses[t].classes[s]._id)}o.weeks?c():s(function(){o.weeks?c():n("API unavailable at this time, so sorry")},5e3)})},u.getSingleSchedule=function(s){return t(function(t,n){console.log(s);o.weeks?t(a(s)):e.get("/campus/"+encodeURI(s.campus)+"/classes/"+s["class"]+"/"+s.weekNumber).then(function(e){console.log(e),t(e.data)})["catch"](function(e){console.log(e),n(e)})})},u.init(),u}function findCtrl(e,t,s){var a=this;a.date=new Date,a.seachModel={},function(){e.getCampusData().then(function(e){console.log("AUTOFILL WORKS"),a.campuses=e})["catch"](function(e){console.error(e)})}(),a.findSchedule=function(){function n(e){console.log(e)}return a.seachModel["class"]?(console.log(a.seachModel),void e.getWeekData(a.seachModel).then(function(e){console.log(e),t.setSchedule(e),s.go("schedule.campus.class.week",{campus:encodeURI(e.campus),cName:encodeURI(e.name),wn:encodeURI(e.weekNumber)})})["catch"](function(e){n("No schedule found")})):n("No class specified")}}function httpFact(e){var t={},s="/api";return t.get=function(t){return e.get(s+t)},t}function scheduleCtrl(e){function t(e){for(var t=0;t<e.length;t++)for(var s=0;s<e[t].slots.length;s++)e[t].slots[s].text=e[t].slots[s].text.replace(/\s*@br@\s*/gi,"<br>");return e}var s=this;s.dayNum=8,s.loading=!0;var a=new Date;console.log(a.getSeconds()),e.getSchedule().then(function(e){console.log(a.getSeconds()),s.loading=!1,e?(e.schedule=t(e.schedule),s.scheduleItem=e,console.log(s.scheduleItem)):s.noData=!0})}function scheduleFact(e,t,s){function a(){u.weekNumber=e.wn,u["class"]=e.cName,u.campus=e.campus,u.weekNumber===c.weekNumber&&u.name===c.name&&(l=!0)}var n={},c={weekNumber:null,name:null},u={},l=void 0;return n.setSchedule=function(e){c=e},n.getSchedule=function(){return s(function(e,s){a(),l?e(c):t.getSingleSchedule(u).then(function(t){console.log("dataFact get schedule res",t),n.setSchedule(t),e(t)})["catch"](function(e){s(e)})})},n}var APPNAME="lukkari";angular.module(APPNAME,["ui.router","ngMaterial","ngSanitize"]),Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this-e)/864e5+e.getDay()+1)/7)},angular.module(APPNAME).config(states,"states"),states.$inject=["$stateProvider","$urlRouterProvider"],angular.module(APPNAME).directive("autoFill",autoFill),autoFill.$inject=["$compile"],angular.module(APPNAME).factory("dataFact",dataFact),dataFact.$inject=["httpFact","$q","$timeout"],angular.module(APPNAME).controller("findCtrl",findCtrl),findCtrl.$inject=["dataFact","scheduleFact","$state"],angular.module(APPNAME).factory("httpFact",httpFact),httpFact.$inject=["$http"],angular.module(APPNAME).controller("scheduleCtrl",scheduleCtrl),scheduleCtrl.$inject=["scheduleFact"],angular.module(APPNAME).factory("scheduleFact",scheduleFact),scheduleFact.$inject=["$stateParams","dataFact","$q"];