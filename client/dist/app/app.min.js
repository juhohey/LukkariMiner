"use strict";function states(e,t){t.otherwise("find");var a="";e.state("find",{url:"/find",templateUrl:"/app/find/find.html"}).state("schedule",{url:a+"/schedule",templateUrl:"/app/schedule/schedule.html"}).state("schedule.campus",{url:a+"/:campus",templateUrl:"/app/schedule/schedule.html"}).state("schedule.class",{url:a+"/:cName",templateUrl:"/app/schedule/schedule.html"}).state("schedule.class.week",{url:a+"/:wn",templateUrl:"/app/schedule/schedule.html"})}function autoFill(e){function t(t,a,n){function s(){o=n.autoFillKeys.split(",")}function c(){function e(t,a){if(t instanceof Array)for(var n=0;n<t.length;n++)t[n]instanceof Object?e(t[n],a):t[n][a]&&i.push({name:t[n][a],"class":t[n]._id});else if(t instanceof Object)for(var s in t)s===a&&i.push({name:t[a],"class":t._id}),t[s]instanceof Array&&e(t[s],a)}if(o instanceof Array)for(var t=0;t<o.length;t++)e(l[n.autoFillVmSrc],o[t]);else e(l[n.autoFillVmSrc],o)}function u(){function e(){for(var e=0;e<i.length;e++)if(n(i[e])>-1&&t.outputs.push(i[e]),t.outputs.length>=10)return}function a(){i.sort(function(e,t){return n(e)-n(t)})}function n(e){return e.name.toLowerCase().indexOf(t.searchModel.toLowerCase())}return t.searchModel.length?(t.outputs=[],e(),void a()):void(t.outputsActive=!1)}var l=t[n.autoFillVm],o=void 0;s();var i=[];t.searchModel=[],i.length||c();(function(){var n="<div ng-click='searchThis()' class='search'><input class='data-search' type='text' ng-model='searchModel' ng-change='inputChanged()'><div class='search-output'><div class='item item-label search-output-single' ng-repeat='searchOutput in outputs track by $index' ><span ng-click='activateSeachOutput(searchOutput)' class=''>{{searchOutput.name}}</span></div></div></div>";a.append(e(n)(t))})();t.inputChanged=function(){i.length||c(),u(),l.seachModel=t.seachModel},t.activateSeachOutput=function(e){t.seachModel=e,l.seachModel=e,a.find("input")[0].value=e.name,t.outputs=[]}}return{scope:"=",link:t,template:"",restrict:"E"}}function dataFact(e,t,a){function n(e,t,n,s){l[e]?n(c[t]):a(function(){l[e]?n(c[t]):s("API unavailable at this time, so sorry")},5e3)}function s(e,t){for(var a=0;a<c.campuses.length;a++)c.campuses[a]._id===e[0].campus&&(c.campuses[a][t]=e)}var c={};c.campuses=[],c.weeks=[];var u=new Date,l={campuses:!1,classes:!1,weeks:!1};return c.init=function(){console.log("Data factory initialized, getting data"),e.get("/campus").then(function(e){c.campuses=e.data,l.campuses=!0,c.initClasses()})["catch"](function(e){console.warn("err@datafact campus",e)})},c.initClasses=function(){function t(a){e.get("/campus/"+encodeURI(c.campuses[a].name)+"/classes").then(function(e){s(e.data,"classes"),a<c.campuses.length-1?t(a+=1):(console.log("classes done"),l.classes=!0,c.initWeeks())})}t(0)},c.initWeeks=function(){function t(a){e.get("/campus/"+encodeURI(c.campuses[a].name)+"/weeks").then(function(e){c.weeks.push(e.data),a<c.campuses.length-1?t(a+=1):(l.weeks=!0,console.log("weeks done"))})}t(0)},c.getWeekData=function(e){for(var t=new Date(u).getWeek(),a=0;a<c.weeks.length;a++)for(var n=0;n<c.weeks[a].length;n++)if(c.weeks[a][n]["class"]===e["class"]&&c.weeks[a][n].weekNumber===t)return c.weeks[a][n].name=e.name,c.weeks[a][n]},c.getCampus=function(){return t(function(e,t){n("campuses","campuses",e,t)})},c.getCampusData=function(){return t(function(e,t){n("classes","campuses",e,t)})},c.getCampusWeeks=function(){return t(function(e,t){n("weeks","weeks",e,t)})},c.getSchedule=function(e){return t(function(t,n){function s(){e.classId||u(),console.log(e),t(o())}function u(){for(var t=0;t<c.campuses.length;t++)for(var a=0;a<c.campuses[t].classes.length;a++)if(c.campuses[t].classes[a].name===e.name)return void(e.classId=c.campuses[t].classes[a]._id)}function o(){for(var t=0;t<c.weeks.length;t++)for(var a=0;a<c.weeks[t].length;a++)if(c.weeks[t][a]["class"]===e.classId)return c.weeks[t][a].name=e.name,c.weeks[t][a]}l.weeks?s():a(function(){l.weeks?s():n("API unavailable at this time, so sorry")},5e3)})},c.init(),c}function findCtrl(e,t,a){var n=this;!function(){e.getCampusData().then(function(e){n.campuses=e})["catch"](function(e){console.error(e)})}(),n.findSchedule=function(){console.log(n.seachModel);var s=e.getWeekData(n.seachModel);console.log(s),t.setSchedule(s),a.go("schedule.class.week",{cName:encodeURI(s.name),wn:encodeURI(s.weekNumber)})}}function httpFact(e){var t={},a="/api";return t.get=function(t){return e.get(a+t)},t}function scheduleCtrl(e){function t(e){for(var t=0;t<e.length;t++)for(var a=0;a<e[t].slots.length;a++);return e}var a=this;e.getSchedule().then(function(e){e.schedule=t(e.schedule),a.scheduleItem=e,console.log(a.scheduleItem)})}function scheduleFact(e,t,a){function n(){u.weekNumber=e.wn,u.name=e.cName,u.weekNumber===c.weekNumber&&u.name===c.name&&(l=!0)}var s={},c={weekNumber:null,name:null},u={},l=void 0;return s.setSchedule=function(e){c=e},s.getSchedule=function(){return a(function(e,a){n(),l?e(c):t.getSchedule(u).then(function(t){s.setSchedule(t),e(c)})["catch"](function(t){e(t)})})},s}var APPNAME="lukkari";angular.module(APPNAME,["ui.router","ngMaterial"]),Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this-e)/864e5+e.getDay()+1)/7)},angular.module(APPNAME).config(states,"states"),states.$inject=["$stateProvider","$urlRouterProvider"],angular.module(APPNAME).directive("autoFill",autoFill),autoFill.$inject=["$compile"],angular.module(APPNAME).factory("dataFact",dataFact),dataFact.$inject=["httpFact, $q, $timeout"],angular.module(APPNAME).controller("findCtrl",findCtrl),findCtrl.$inject=["dataFact,scheduleFact, $state"],angular.module(APPNAME).factory("httpFact",httpFact),angular.module(APPNAME).controller("scheduleCtrl",scheduleCtrl),scheduleCtrl.$inject=["scheduleFact"],angular.module(APPNAME).factory("scheduleFact",scheduleFact),scheduleFact.$inject=["$stateParams, dataFact, $q"];